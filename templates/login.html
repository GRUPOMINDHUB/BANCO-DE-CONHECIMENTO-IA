{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'estilo.css' %}">
    <title>Login - Mindhub</title>
</head>


<body>
    <h1 class="titulo-boas-vindas">Acesse MindLinküß†</h1>
    <div class="login-container">
        <h2 style="color: #343a40; margin-bottom: 20px;">Grupo Mindhub üè¢</h2>
        <label>E-mail</label>
        <input type="email" class="input_login" id="email" placeholder="seu@email.com">
        <label>Senha</label>
        <input type="password" class="input_login" id="password" placeholder="sua senha">
        <input type="button" class="input_btn" id="login_btn" value="Entrar">
    </div>

    <audio id="login-sound" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>

    <script>
        const botao = document.querySelector('#login_btn');
        const som = document.querySelector('#login-sound');

        botao.addEventListener('click', async () => {
            const email = document.querySelector('#email').value;
            const senha = document.querySelector('#password').value;

            try {
                const resposta = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ email, senha })
                });

                const dados = await resposta.json();

                if (resposta.ok) {
                    // Toca o som
                    som.play();

                    // Efeito visual
                    document.body.classList.add('fade-out');
                    
                    // Admin e Monitor v√£o para o painel; Aluno vai para o chat IA
                    const role = dados.role || '';
                    const url = (role === 'ADMIN' || role === 'MONITOR') ? '/monitor/' : '/ia';
                    
                    setTimeout(() => {
                        window.location.href = url;
                    }, 1200);
                } else {
                    alert(dados.mensagem || "Erro ao fazer login");
                }
            } catch (erro) {
                console.error("Erro na requisi√ß√£o:", erro);
                alert("Erro ao conectar com o servidor.");
            }
        });
    </script>
</body>
</html>
